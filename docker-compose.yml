version: '3.7'

services:
  django:
    build:
      dockerfile: Dockerfile
      context: ./
      shm_size: 512mb
    depends_on:
    - postgres
    logging:
      driver: journald
    environment:
    - DB_HOST=postgres
    volumes:
    - ./:/app

  postgres:
    image: postgres:10
    restart: unless-stopped
    logging:
      driver: journald
    environment:
    - POSTGRES_PASSWORD="${DB_PASSWORD}"
    - POSTGRES_USER="${DB_USER}"
    - POSTGRES_DB="${DB_NAME}"
    volumes:
    - ./postgres/data:/var/lib/postgresql/data
    - ./postgres/run:/var/run/postgresql
    - ./dump:/dump
